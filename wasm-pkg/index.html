<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trueno-DB Browser Demo</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #0f0f23;
            color: #cccccc;
        }
        h1 { color: #00d4aa; }
        .status {
            padding: 10px;
            margin: 10px 0;
            background: #1a1a2e;
            border-radius: 4px;
        }
        .tier { font-weight: bold; color: #00d4aa; }
        pre {
            background: #1a1a2e;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
        }
        button {
            background: #00d4aa;
            color: #0f0f23;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }
        button:hover { background: #00ffc8; }
        #results { margin-top: 20px; }
    </style>
</head>
<body>
    <h1>üöÄ Trueno-DB Browser Analytics</h1>

    <div class="status" id="status">
        <strong>Status:</strong> Initializing...
    </div>

    <div class="status" id="capabilities">
        <strong>Compute Tier:</strong> Detecting...
    </div>

    <h2>SQL Query</h2>
    <textarea id="sql" rows="4" style="width: 100%; padding: 10px; background: #1a1a2e; color: #cccccc; border: 1px solid #444;">
SELECT playerID, yearID, HR, BA FROM batting ORDER BY HR DESC LIMIT 5
    </textarea>
    <br>
    <button onclick="runQuery()">Execute Query</button>
    <button onclick="loadDemo()">Load Demo Data</button>

    <div id="results"></div>

    <h2>Architecture</h2>
    <pre>
Browser ‚Üí WASM ‚Üí trueno-db ‚Üí trueno (SIMD) ‚Üí Results
                     ‚Üì
                QueryEngine
                     ‚Üì
                Arrow Tables
    </pre>

    <script type="module">
        import init, {
            Database,
            DatabaseConfig,
            detect_capabilities,
            demo_version
        } from './pkg/trueno_db_wasm.js';

        let db = null;

        async function initWasm() {
            try {
                await init();

                document.getElementById('status').innerHTML =
                    `<strong>Status:</strong> ‚úÖ ${demo_version()}`;

                // Detect capabilities
                const caps = await detect_capabilities();
                const tier = caps.tier || 'unknown';
                const tierEmoji = tier === 'webgpu' ? 'üöÄ' :
                                tier === 'simd128' ? '‚ö°' : 'üêå';

                document.getElementById('capabilities').innerHTML =
                    `<strong>Compute Tier:</strong> ${tierEmoji} <span class="tier">${tier.toUpperCase()}</span>
                    <br>WebGPU: ${caps.webgpu ? '‚úÖ' : '‚ùå'} | SIMD128: ${caps.simd128 ? '‚úÖ' : '‚ùå'}`;

                // Create database
                const config = new DatabaseConfig()
                    .backend(tier)
                    .cache_size_mb(256);
                db = new Database(config);

            } catch (err) {
                document.getElementById('status').innerHTML =
                    `<strong>Error:</strong> ${err}`;
            }
        }

        window.runQuery = async function() {
            const sql = document.getElementById('sql').value;
            const resultsDiv = document.getElementById('results');

            resultsDiv.innerHTML = '<pre>Executing query...</pre>';

            try {
                const result = await db.query(sql);
                resultsDiv.innerHTML = `<pre>Query executed!\n(Full implementation pending)</pre>`;
            } catch (err) {
                resultsDiv.innerHTML = `<pre style="color: #ff5555;">Error: ${err}</pre>`;
            }
        };

        // Lahman Baseball Database - Public Domain
        // Source: Chadwick Baseball Bureau (501c3)
        // https://github.com/chadwickbureau/baseballdatabank
        const DEMO_DATA = {
            batting: [
                { playerID: 'ruthba01', yearID: 1927, teamID: 'NYA', G: 151, AB: 540, R: 158, H: 192, HR: 60, RBI: 164, BA: 0.356 },
                { playerID: 'ruthba01', yearID: 1928, teamID: 'NYA', G: 154, AB: 536, R: 163, H: 173, HR: 54, RBI: 142, BA: 0.323 },
                { playerID: 'gaborou01', yearID: 1923, teamID: 'NYA', G: 152, AB: 577, R: 97, H: 188, HR: 29, RBI: 125, BA: 0.326 },
                { playerID: 'willite01', yearID: 1941, teamID: 'BOS', G: 143, AB: 456, R: 135, H: 185, HR: 37, RBI: 120, BA: 0.406 },
                { playerID: 'willite01', yearID: 1942, teamID: 'BOS', G: 150, AB: 522, R: 141, H: 186, HR: 36, RBI: 137, BA: 0.356 },
                { playerID: 'mantlmi01', yearID: 1956, teamID: 'NYA', G: 150, AB: 533, R: 132, H: 188, HR: 52, RBI: 130, BA: 0.353 },
                { playerID: 'mantlmi01', yearID: 1957, teamID: 'NYA', G: 144, AB: 474, R: 121, H: 173, HR: 34, RBI: 94, BA: 0.365 },
                { playerID: 'aaronha01', yearID: 1957, teamID: 'MLN', G: 151, AB: 615, R: 118, H: 198, HR: 44, RBI: 132, BA: 0.322 },
                { playerID: 'mayswi01', yearID: 1954, teamID: 'NY1', G: 151, AB: 565, R: 119, H: 195, HR: 41, RBI: 110, BA: 0.345 },
                { playerID: 'bondsba01', yearID: 2001, teamID: 'SFN', G: 153, AB: 476, R: 129, H: 156, HR: 73, RBI: 137, BA: 0.328 },
            ]
        };

        window.loadDemo = async function() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<pre>Loading Lahman Baseball data...</pre>';

            try {
                // Load embedded demo data
                await db.load_json('batting', JSON.stringify(DEMO_DATA.batting));
                resultsDiv.innerHTML = `<pre>Loaded ${DEMO_DATA.batting.length} batting records\nSource: Lahman Database (Chadwick Baseball Bureau)</pre>`;
            } catch (err) {
                resultsDiv.innerHTML = `<pre style="color: #ff5555;">Error: ${err}</pre>`;
            }
        };

        // Initialize on page load
        initWasm();
    </script>
</body>
</html>
